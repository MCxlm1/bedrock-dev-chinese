import{_ as p,E as t,j as h,k,a5 as i,A as n,I as l,J as e}from"./chunks/framework.3Z9w-w8R.js";const b=JSON.parse('{"title":"材质配置说明","description":"本文将详细介绍材质文件的结构和配置。","frontmatter":{"title":"材质配置说明","tags":["expert"],"mentions":["MedicalJewel105","SmokeyStack"],"description":"本文将详细介绍材质文件的结构和配置。"},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"材质文件","slug":"材质文件","link":"#材质文件","children":[]},{"level":2,"title":"材质语法","slug":"材质语法","link":"#材质语法","children":[]},{"level":2,"title":"材质所有属性字段概述","slug":"材质所有属性字段概述","link":"#材质所有属性字段概述","children":[{"level":3,"title":"渲染状态","slug":"渲染状态","link":"#渲染状态","children":[{"level":4,"title":"states","slug":"states","link":"#states","children":[]}]},{"level":3,"title":"着色器路径","slug":"着色器路径","link":"#着色器路径","children":[{"level":4,"title":"vertexShader","slug":"vertexshader","link":"#vertexshader","children":[]},{"level":4,"title":"vrGeometryShader或geometryShader","slug":"vrgeometryshader或geometryshader","link":"#vrgeometryshader或geometryshader","children":[]},{"level":4,"title":"fragmentShader","slug":"fragmentshader","link":"#fragmentshader","children":[]}]},{"level":3,"title":"着色器宏定义","slug":"着色器宏定义","link":"#着色器宏定义","children":[{"level":4,"title":"defines","slug":"defines","link":"#defines","children":[]}]},{"level":3,"title":"运行时状态","slug":"运行时状态","link":"#运行时状态","children":[{"level":4,"title":"深度测试","slug":"深度测试","link":"#深度测试","children":[{"level":5,"title":"depthFunc","slug":"depthfunc","link":"#depthfunc","children":[]}]},{"level":4,"title":"模板掩码测试","slug":"模板掩码测试","link":"#模板掩码测试","children":[{"level":5,"title":"stencilRef","slug":"stencilref","link":"#stencilref","children":[]},{"level":5,"title":"stencilRefOverride","slug":"stencilrefoverride","link":"#stencilrefoverride","children":[]},{"level":5,"title":"stencilReadMask","slug":"stencilreadmask","link":"#stencilreadmask","children":[]},{"level":5,"title":"stencilWriteMask","slug":"stencilwritemask","link":"#stencilwritemask","children":[]},{"level":5,"title":"frontFace和backFace","slug":"frontface和backface","link":"#frontface和backface","children":[]}]},{"level":4,"title":"Blend 半透明对象颜色混合","slug":"blend-半透明对象颜色混合","link":"#blend-半透明对象颜色混合","children":[{"level":5,"title":"blendSrc","slug":"blendsrc","link":"#blendsrc","children":[]},{"level":5,"title":"blendDst","slug":"blenddst","link":"#blenddst","children":[]},{"level":5,"title":"alphaSrc","slug":"alphasrc","link":"#alphasrc","children":[]},{"level":5,"title":"alphaDst","slug":"alphadst","link":"#alphadst","children":[]}]},{"level":4,"title":"Sample 纹理采样","slug":"sample-纹理采样","link":"#sample-纹理采样","children":[{"level":5,"title":"samplerStates","slug":"samplerstates","link":"#samplerstates","children":[]},{"level":5,"title":"samplerIndex","slug":"samplerindex","link":"#samplerindex","children":[]},{"level":5,"title":"textureFilter","slug":"texturefilter","link":"#texturefilter","children":[]},{"level":5,"title":"textureWrap","slug":"texturewrap","link":"#texturewrap","children":[]}]},{"level":4,"title":"顶点","slug":"顶点","link":"#顶点","children":[{"level":5,"title":"vertexFields","slug":"vertexfields","link":"#vertexfields","children":[]}]},{"level":4,"title":"光栅化器环境配置","slug":"光栅化器环境配置","link":"#光栅化器环境配置","children":[{"level":5,"title":"msaaSupport","slug":"msaasupport","link":"#msaasupport","children":[]},{"level":5,"title":"depth offset","slug":"depth-offset","link":"#depth-offset","children":[]}]},{"level":4,"title":"图元","slug":"图元","link":"#图元","children":[{"level":5,"title":"primitiveMode","slug":"primitivemode","link":"#primitivemode","children":[]}]}]},{"level":3,"title":"材质变体","slug":"材质变体","link":"#材质变体","children":[{"level":4,"title":"variants","slug":"variants","link":"#variants","children":[]}]}]},{"level":2,"title":"材质合并规则","slug":"材质合并规则","link":"#材质合并规则","children":[]}],"relativePath":"documentation/material-config-description.md","filePath":"documentation/material-config-description.md"}'),r={name:"documentation/material-config-description.md"};function d(o,s,c,D,u,g){const a=t("CodeHeader");return k(),h("div",null,[s[3]||(s[3]=i('<div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>材质并不适合初学者。请准备好应对潜在的崩溃、内容日志错误和长时间加载。</p></div><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>本文翻译自 <a href="https://mc.163.com/dev/mcmanual/mc-dev/mcguide/" target="_blank" rel="noreferrer">https://mc.163.com/dev/mcmanual/mc-dev/mcguide/</a> - 由网易（中国版开发者）提供。文章将详细介绍材质文件的结构和配置。</p><h2 id="材质文件" tabindex="-1">材质文件 <a class="header-anchor" href="#材质文件" aria-label="Permalink to &quot;材质文件&quot;">​</a></h2><p>我们将解释原生微软的材质文件。首先，目录下的文件基本上是带有&quot;.material&quot;后缀的文件。此外，还有三个重要的json文件，分别是common.json、fancy.json、sad.json。</p><p>让我们先看看sad.json和fancy.json。它们用于控制图像质量表现。每个文件都定义了材质文件列表。fancy.json通常比sad.json定义了更多的材质文件，并且可能为一些材质文件添加了一些额外的宏，着色器可以通过判断这些宏来进行特殊处理：</p>',6)),n(a,null,{default:l(()=>s[0]||(s[0]=[e("sad.json")])),_:1}),s[4]||(s[4]=i(`<div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/sad.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/entity.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/terrain.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/portal.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/barrier.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/wireframe.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div>`,1)),n(a,null,{default:l(()=>s[1]||(s[1]=[e("fancy.json")])),_:1}),s[5]||(s[5]=i(`<div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/fancy.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;FANCY&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">] },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/entity.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;FANCY&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">] },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/terrain.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;FANCY&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">] },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/hologram.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/portal.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;FANCY&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">] },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/barrier.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/wireframe.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>可以看出，fancy.json比sad.json定义了更多的fancy.material和hologram.material材质文件，并且还为多个材质文件定义了FANCY宏。游戏中设置/视频/精致纹理的开关就是控制sad和fancy之间的切换。当开启精致纹理开关时，fancy.json中的材质文件会生效，关闭时，sad.json中的材质文件会生效。</p><p>为了获得更好的性能，fancy.json中的材质文件通常具有更复杂的操作，而sad.json中的材质通常牺牲一些渲染性能以换取更好的性能。如果开发者需要编写更复杂的着色器，建议同时编写一个低成本版本，然后分别在fancy和sad中定义。让玩家通过游戏中的精致纹理选项控制是否开启相应效果。</p>`,3)),n(a,null,{default:l(()=>s[2]||(s[2]=[e("common.json")])),_:1}),s[6]||(s[6]=i(`<div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/particles.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/shadows.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/sky.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/ui.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/ui3D.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/portal.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/barrier.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;path&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;materials/wireframe.material&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>与sad和fancy可以相互切换不同，common.json中定义的材质文件将在进入游戏后加载。除了在common.json、sad.json、fancy.json中声明的材质文件外，其他材质文件均不会被加载。</p><h2 id="材质语法" tabindex="-1">材质语法 <a class="header-anchor" href="#材质语法" aria-label="Permalink to &quot;材质语法&quot;">​</a></h2><p>我们使用材质文件中的一个实体材质文件entity.material来解释，打开文件，可以看到文件以materials开头，然后定义版本号version为1.0.0，这些都是固定格式，它们标识了此材质文件的解析方式，我们可以暂时忽略它而不修改它。</p><p>可以看到材质中每个字段的定义都是键值对的形式，例如：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">	&quot;vertexShader&quot;</span><span style="--shiki-dark:#F44747;--shiki-light:#CD3131;">:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;"> &quot;shaders/entity.vertex&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>冒号左侧表示键vertexShader，右侧表示值shaders/entity.vertex；</p><p>还有列表形式的定义：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">	&quot;vertexFields&quot;</span><span style="--shiki-dark:#F44747;--shiki-light:#CD3131;">:</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Position&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Normal&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;UV0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    ],</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>用符号[ ]声明的是列表，然后里面是每个子元素的json定义。</p><h2 id="材质所有属性字段概述" tabindex="-1">材质所有属性字段概述 <a class="header-anchor" href="#材质所有属性字段概述" aria-label="Permalink to &quot;材质所有属性字段概述&quot;">​</a></h2><h3 id="渲染状态" tabindex="-1">渲染状态 <a class="header-anchor" href="#渲染状态" aria-label="Permalink to &quot;渲染状态&quot;">​</a></h3><h4 id="states" tabindex="-1"><code class="shiki"><span>states</span></code> <a class="header-anchor" href="#states" aria-label="Permalink to &quot;\`states\`&quot;">​</a></h4><p>配置渲染环境，它可以有以下值：</p><ul><li><p><code class="shiki"><span>EnableAlphaToCoverage</span></code>：一种用于半透明物体的独立于顺序的渲染方法。此开关仅在支持MSAA的环境中有效。启用后，物体边缘将根据透明度更准确地软化和过渡。它也可以用于一些具有大量网格重叠的复杂场景。</p></li><li><p><code class="shiki"><span>Wireframe</span></code>：绘制线框模式</p></li><li><p><code class="shiki"><span>Blending</span></code>: 启用颜色混合模式，通常用于渲染半透明对象。声明此选项后，通常需要声明混合因子blendSrc, blendDst</p></li><li><p><code class="shiki"><span>DisableColorWrite</span></code>：不将颜色值写入颜色缓冲区，RGBA通道都不写入</p></li><li><p><code class="shiki"><span>DisableAlphaWrite</span></code>：不将透明度alpha值写入颜色缓冲区，允许写入RGB值</p></li><li><p><code class="shiki"><span>DisableRGBWrite</span></code>：不将透明度RGB值写入颜色缓冲区，允许写入alpha值</p></li><li><p><code class="shiki"><span>DisableDepthTest</span></code>：关闭深度测试</p></li><li><p><code class="shiki"><span>DisableDepthWrite</span></code>：关闭深度写入</p></li><li><p><code class="shiki"><span>DisableCulling</span></code>: 同时渲染正面和背面</p></li><li><p><code class="shiki"><span>InvertCulling</span></code>：使用正面剔除。默认是背面剔除。声明此选项后，渲染背面并剔除正面。</p></li><li><p><code class="shiki"><span>StencilWrite</span></code>: 启用模板掩码写入</p></li><li><p><code class="shiki"><span>EnableStencilTest</span></code>：启用模板掩码测试</p></li></ul><h3 id="着色器路径" tabindex="-1">着色器路径 <a class="header-anchor" href="#着色器路径" aria-label="Permalink to &quot;着色器路径&quot;">​</a></h3><h4 id="vertexshader" tabindex="-1"><code class="shiki"><span>vertexShader</span></code> <a class="header-anchor" href="#vertexshader" aria-label="Permalink to &quot;\`vertexShader\`&quot;">​</a></h4><p>顶点着色器的路径，通常为shaders/XXX.vertex。</p><h4 id="vrgeometryshader或geometryshader" tabindex="-1"><code class="shiki"><span>vrGeometryShader</span></code>或<code class="shiki"><span>geometryShader</span></code> <a class="header-anchor" href="#vrgeometryshader或geometryshader" aria-label="Permalink to &quot;\`vrGeometryShader\`或\`geometryShader\`&quot;">​</a></h4><p>几何着色器的路径，通常为shaders/XXX.geometry，在移动端不使用，不需要修改。</p><h4 id="fragmentshader" tabindex="-1"><code class="shiki"><span>fragmentShader</span></code> <a class="header-anchor" href="#fragmentshader" aria-label="Permalink to &quot;\`fragmentShader\`&quot;">​</a></h4><p>片段着色器的路径，通常为shaders/XXX.fragment。</p><h3 id="着色器宏定义" tabindex="-1">着色器宏定义 <a class="header-anchor" href="#着色器宏定义" aria-label="Permalink to &quot;着色器宏定义&quot;">​</a></h3><h4 id="defines" tabindex="-1"><code class="shiki"><span>defines</span></code> <a class="header-anchor" href="#defines" aria-label="Permalink to &quot;\`defines\`&quot;">​</a></h4><p>为使用的着色器定义宏。为了代码复用，我们使用相同的着色器用于许多不同的材质。这时，如果你想根据当前材质在着色器中的某处执行不同的逻辑，可以通过材质defines声明的宏来判断。我们可以使用材质entity_for_skeleton作为例子。在这里我们可以看到定义了三个宏USE_SKINNING、USE_OVERLAY和NETEASE_SKINNING。</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;entity_for_skeleton&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;vertexShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/entity.vertex&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;vrGeometryShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/entity.geometry&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;fragmentShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/entity.fragment&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;USE_SKINNING&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;USE_OVERLAY&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;NETEASE_SKINNING&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> ],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;vertexFields&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		{ </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Position&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		{ </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Normal&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		{ </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;BoneId0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		{ </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;UV0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">	],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;msaaSupport&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Both&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;+samplerStates&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		{</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">			&quot;samplerIndex&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658;">0</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">			&quot;textureFilter&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Point&quot;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		}</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">	]</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>查看顶点着色器entity.vertex，会有#ifdef、#else、#endif来判断宏并执行不同的逻辑分支。这些宏的判断语句在编译时处理，不像传统的着色器中的if。Else，编译时处理的逻辑分支在实际运行中不会生成，而且由于分支的存在也不会降低性能。此外，如下所示，宏也可以进行多层判断。首先判断NETEASE_SKINNING宏，然后在内部执行逻辑中判断LARGE_VERTEX_SHADER_UNIFORMS宏：</p><div class="language-glsl vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB;">#ifdef</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF;"> NETEASE_SKINNING</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		MAT4 boneMat = </span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26;">transpose</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">(</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26;">mat3x4ToMat4</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080;">BONES_70</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF;">int</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">(BONEID_0)]));</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		entitySpacePosition = boneMat * POSITION;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		entitySpaceNormal = boneMat * NORMAL;</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB;">#else</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB;">	#if</span><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB;"> defined</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF;">(LARGE_VERTEX_SHADER_UNIFORMS)</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		entitySpacePosition = </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080;">BONES</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF;">int</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">(BONEID_0)] * POSITION;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		entitySpaceNormal = </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080;">BONES</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">[</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF;">int</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">(BONEID_0)] * NORMAL;</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB;">	#else</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		entitySpacePosition = BONE * POSITION;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">		entitySpaceNormal = BONE * NORMAL;</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB;">	#endif</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB;">#endif</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="运行时状态" tabindex="-1">运行时状态 <a class="header-anchor" href="#运行时状态" aria-label="Permalink to &quot;运行时状态&quot;">​</a></h3><h4 id="深度测试" tabindex="-1">深度测试 <a class="header-anchor" href="#深度测试" aria-label="Permalink to &quot;深度测试&quot;">​</a></h4><h5 id="depthfunc" tabindex="-1"><code class="shiki"><span>depthFunc</span></code> <a class="header-anchor" href="#depthfunc" aria-label="Permalink to &quot;\`depthFunc\`&quot;">​</a></h5><p>深度检测通过函数，可以使用以下值：</p><ul><li><p><code class="shiki"><span>Always</span></code>: 始终通过</p></li><li><p><code class="shiki"><span>Equal</span></code>：当深度值等于缓冲区值时通过</p></li><li><p><code class="shiki"><span>NotEqual</span></code>：当深度值不等于缓冲区值时通过</p></li><li><p><code class="shiki"><span>Less</span></code>：当深度值小于缓冲区值时通过</p></li><li><p><code class="shiki"><span>Greater</span></code>：当深度值大于缓冲区值时通过</p></li><li><p><code class="shiki"><span>GreaterEqual</span></code>：当深度值大于或等于缓冲区值时通过</p></li><li><p><code class="shiki"><span>LessEqual</span></code>：当深度值小于或等于缓冲区值时通过</p></li></ul><p>关联状态渲染环境配置：</p><ul><li><p><code class="shiki"><span>DisableDepthTest</span></code>：关闭深度测试</p></li><li><p><code class="shiki"><span>DisableDepthWrite</span></code>：关闭深度写入</p></li></ul><h4 id="模板掩码测试" tabindex="-1">模板掩码测试 <a class="header-anchor" href="#模板掩码测试" aria-label="Permalink to &quot;模板掩码测试&quot;">​</a></h4><h5 id="stencilref" tabindex="-1"><code class="shiki"><span>stencilRef</span></code> <a class="header-anchor" href="#stencilref" aria-label="Permalink to &quot;\`stencilRef\`&quot;">​</a></h5><p>用于与掩码缓冲区比较或写入掩码缓冲区的值</p><h5 id="stencilrefoverride" tabindex="-1"><code class="shiki"><span>stencilRefOverride</span></code> <a class="header-anchor" href="#stencilrefoverride" aria-label="Permalink to &quot;\`stencilRefOverride\`&quot;">​</a></h5><p>是否使用缓冲区的当前值作为stencilRef，支持0或1：</p><ul><li><p><code class="shiki"><span>1</span></code>：使用配置的stencilRef。如果配置了stencilRef，则stencilRefOverride将自动取1</p></li><li><p><code class="shiki"><span>0</span></code>：使用缓冲区的当前值作为stencilRef，在这种情况下不配置stencilRef</p></li></ul><h5 id="stencilreadmask" tabindex="-1"><code class="shiki"><span>stencilReadMask</span></code> <a class="header-anchor" href="#stencilreadmask" aria-label="Permalink to &quot;\`stencilReadMask\`&quot;">​</a></h5><p>掩码缓冲区值和stencilRef值在比较前与stencilReadMask进行按位与操作</p><h5 id="stencilwritemask" tabindex="-1"><code class="shiki"><span>stencilWriteMask</span></code> <a class="header-anchor" href="#stencilwritemask" aria-label="Permalink to &quot;\`stencilWriteMask\`&quot;">​</a></h5><p>stencilRef值在写入掩码缓冲区前与stencilWriteMask进行按位与操作</p><h5 id="frontface和backface" tabindex="-1"><code class="shiki"><span>frontFace</span></code>和<code class="shiki"><span>backFace</span></code> <a class="header-anchor" href="#frontface和backface" aria-label="Permalink to &quot;\`frontFace\`和\`backFace\`&quot;">​</a></h5><p>配置在网格的正面或背面使用哪种掩码测试函数。此外，判断顺序是先掩码检测，然后深度检测。需要配置以下操作：</p><ul><li><p><code class="shiki"><span>stencilFunc</span></code>: stencilRef与掩码缓冲区比较时使用的方法，支持以下值：</p><ul><li><code class="shiki"><span>Always</span></code>: 始终通过</li><li><code class="shiki"><span>Equal</span></code>：当stencilRef等于缓冲区值时通过</li><li><code class="shiki"><span>NotEqual</span></code>：当stencilRef不等于缓冲区值时通过</li><li><code class="shiki"><span>Less</span></code>：当stencilRef小于缓冲区值时通过</li><li><code class="shiki"><span>Greater</span></code>：当stencilRef大于缓冲区值时通过</li><li><code class="shiki"><span>GreaterEqual</span></code>：当stencilRef大于或等于缓冲区值时通过</li><li><code class="shiki"><span>LessEqual</span></code>：当stencilRef小于或等于缓冲区值时通过</li></ul></li><li><p><code class="shiki"><span>stencilFailOp</span></code>：当stencilFunc比较函数返回失败时执行的处理，支持以下值：</p><ul><li><code class="shiki"><span>Keep</span></code>：保持缓冲区原始值</li><li><code class="shiki"><span>Replace</span></code>：将stencilRef位与stencilWriteMask的值写入缓冲区</li></ul></li><li><p><code class="shiki"><span>stencilDepthFailOp</span></code>：stencilFunc比较函数返回成功，但深度测试失败时执行的处理，支持以下值：</p><ul><li><code class="shiki"><span>Keep</span></code>：保持缓冲区原始值</li><li><code class="shiki"><span>Replace</span></code>：将stencilRef位与stencilWriteMask的值写入缓冲区</li></ul></li><li><p><code class="shiki"><span>stencilPassOp</span></code>: stencilFunc比较函数返回成功，且深度测试成功时执行的处理，支持以下值：</p><ul><li><code class="shiki"><span>Keep</span></code>：保持缓冲区原始值</li><li><code class="shiki"><span>Replace</span></code>：将stencilRef位与stencilWriteMask的值写入缓冲区</li></ul></li></ul><p>关联状态渲染环境配置：</p><ul><li><p><code class="shiki"><span>StencilWrite</span></code>：启用掩码写入</p></li><li><p><code class="shiki"><span>EnableStencilTest</span></code>: 启用掩码测试</p></li></ul><p>最后，让我们看一个例子：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">    &quot;shadow_back&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;+states&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">        &quot;StencilWrite&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">        &quot;DisableColorWrite&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">        &quot;DisableDepthWrite&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">        &quot;InvertCulling&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">        &quot;EnableStencilTest&quot;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">      ],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;vertexShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/position.vertex&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;vrGeometryShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/position.geometry&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;fragmentShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/flat_white.fragment&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;frontFace&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilFunc&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Always&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilFailOp&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Keep&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilDepthFailOp&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Keep&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilPassOp&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Replace&quot;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">      },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;backFace&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilFunc&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Always&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilFailOp&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Keep&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilDepthFailOp&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Keep&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">        &quot;stencilPassOp&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Replace&quot;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">      },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;stencilRef&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658;">1</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;stencilReadMask&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658;">255</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;stencilWriteMask&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658;">1</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;vertexFields&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Position&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">      ],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;msaaSupport&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Both&quot;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>在示例中，StencilWrite表示支持写入掩码缓冲区，EnableStencilTest表示开启掩码测试，frontFace的配置表示在渲染正面时掩码测试始终通过。如果深度测试失败，缓冲区值保持不变。如果也通过，则将模板位和stencilWriteMask的值写入缓冲区，即1 &amp; 1 = 1值。backFace的配置也类似。</p><h4 id="blend-半透明对象颜色混合" tabindex="-1">Blend 半透明对象颜色混合 <a class="header-anchor" href="#blend-半透明对象颜色混合" aria-label="Permalink to &quot;Blend 半透明对象颜色混合&quot;">​</a></h4><p>半透明对象的渲染需要配置混合因子。最终输出rgb颜色值 = 当前颜色值 _ 源混合因子 + 缓冲区中的颜色值 _ 目标混合因子</p><h5 id="blendsrc" tabindex="-1"><code class="shiki"><span>blendSrc</span></code> <a class="header-anchor" href="#blendsrc" aria-label="Permalink to &quot;\`blendSrc\`&quot;">​</a></h5><p>源混合因子</p><h5 id="blenddst" tabindex="-1"><code class="shiki"><span>blendDst</span></code> <a class="header-anchor" href="#blenddst" aria-label="Permalink to &quot;\`blendDst\`&quot;">​</a></h5><p>目标混合因子</p><h5 id="alphasrc" tabindex="-1"><code class="shiki"><span>alphaSrc</span></code> <a class="header-anchor" href="#alphasrc" aria-label="Permalink to &quot;\`alphaSrc\`&quot;">​</a></h5><p>计算alpha时的源混合因子，通常不配置以采用默认值</p><h5 id="alphadst" tabindex="-1"><code class="shiki"><span>alphaDst</span></code> <a class="header-anchor" href="#alphadst" aria-label="Permalink to &quot;\`alphaDst\`&quot;">​</a></h5><p>计算alpha时的目标混合因子，通常不配置以采用默认值</p><p>总共来说，混合因子可以取以下值：</p><ul><li><p><code class="shiki"><span>DestColor</span></code>：缓冲区颜色值</p></li><li><p><code class="shiki"><span>SourceColor</span></code>：当前颜色值</p></li><li><p><code class="shiki"><span>Zero</span></code>：(0,0,0)</p></li><li><p><code class="shiki"><span>One</span></code>：(1,1,1)</p></li><li><p><code class="shiki"><span>OneMinusDestColor</span></code>: (1,1,1) - 缓冲区颜色值</p></li><li><p><code class="shiki"><span>OneMinusSrcColor</span></code>: (1,1,1) - 当前颜色值</p></li><li><p><code class="shiki"><span>SourceAlpha</span></code>：当前颜色中的alpha值</p></li><li><p><code class="shiki"><span>DestAlpha</span></code>：缓冲区颜色中的alpha值</p></li><li><p><code class="shiki"><span>OneMinusSrcAlpha</span></code>：1 - 当前颜色值中的alpha值</p></li></ul><p>在引擎中，默认为：</p><ul><li><p><code class="shiki"><span>blendSrc</span></code>：SourceAlpha</p></li><li><p><code class="shiki"><span>blendDst</span></code>：OneMinusSrcAlpha</p></li><li><p><code class="shiki"><span>alphaSrc</span></code>：One</p></li><li><p><code class="shiki"><span>alphaDst</span></code>：OneMinusSrcAlpha</p></li></ul><p>关联状态渲染环境配置：</p><ul><li><p><code class="shiki"><span>Blending</span></code>: 启用颜色混合模式，通常用于渲染半透明对象。声明此选项后，通常需要声明混合因子blendSrc, blendDst</p></li><li><p><code class="shiki"><span>DisableColorWrite</span></code>：不将颜色值写入颜色缓冲区，RGBA通道都不写入</p></li><li><p><code class="shiki"><span>DisableAlphaWrite</span></code>：不将透明度alpha值写入颜色缓冲区，允许写入RGB值</p></li><li><p><code class="shiki"><span>DisableRGBWrite</span></code>：不将透明度RGB值写入颜色缓冲区，允许写入alpha值</p></li></ul><h4 id="sample-纹理采样" tabindex="-1">Sample 纹理采样 <a class="header-anchor" href="#sample-纹理采样" aria-label="Permalink to &quot;Sample 纹理采样&quot;">​</a></h4><h5 id="samplerstates" tabindex="-1"><code class="shiki"><span>samplerStates</span></code> <a class="header-anchor" href="#samplerstates" aria-label="Permalink to &quot;\`samplerStates\`&quot;">​</a></h5><p>配置采样状态，值为列表，根据要采样的纹理数量配置每个纹理。通常，如果在顶点属性中声明了UV0和UV1，意味着需要采样两个纹理，这里需要配置两个元素。让我们看看子元素的定义：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">{</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">    &quot;samplerIndex&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658;">0</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">    &quot;textureFilter&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Point&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">    &quot;textureWrap&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Repeat&quot;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>每个属性定义如下：</p><h5 id="samplerindex" tabindex="-1"><code class="shiki"><span>samplerIndex</span></code> <a class="header-anchor" href="#samplerindex" aria-label="Permalink to &quot;\`samplerIndex\`&quot;">​</a></h5><p>数字，表示当前正在设置的纹理属性，从0开始</p><h5 id="texturefilter" tabindex="-1"><code class="shiki"><span>textureFilter</span></code> <a class="header-anchor" href="#texturefilter" aria-label="Permalink to &quot;\`textureFilter\`&quot;">​</a></h5><p>纹理过滤模式（默认为Point），当实际显示的纹理贴图与原图相比放大或缩小时，新分辨率图与原分辨率图上的像素之间的映射关系可以有以下值：</p><ul><li><p><code class="shiki"><span>Point</span></code>：点采样</p></li><li><p><code class="shiki"><span>Bilinear</span></code>: 双线性采样</p></li><li><p><code class="shiki"><span>Trilinear</span></code>: 三线性采样</p></li><li><p><code class="shiki"><span>MipMapBilinear</span></code>：MipMap双线性采样</p></li><li><p><code class="shiki"><span>TexelAA</span></code>：Texel抗锯齿（并非所有设备都支持，不推荐）</p></li><li><p><code class="shiki"><span>PCF</span></code>：按比较函数采样（并非所有设备都支持，不推荐）</p></li></ul><h5 id="texturewrap" tabindex="-1"><code class="shiki"><span>textureWrap</span></code> <a class="header-anchor" href="#texturewrap" aria-label="Permalink to &quot;\`textureWrap\`&quot;">​</a></h5><p>纹理包裹模式，控制当uv超出[0,1]时应该采样什么样的纹理。它可以有以下值：</p><ul><li><p><code class="shiki"><span>Repeat</span></code>：重复，即对值取模到[0, 1]进行采样</p></li><li><p><code class="shiki"><span>Clamp</span></code>：边缘采样，采样最近边缘的值，即如果1.1更接近1，则取1；如果-0.1更接近0，则取0。</p></li></ul><h4 id="顶点" tabindex="-1">顶点 <a class="header-anchor" href="#顶点" aria-label="Permalink to &quot;顶点&quot;">​</a></h4><h5 id="vertexfields" tabindex="-1"><code class="shiki"><span>vertexFields</span></code> <a class="header-anchor" href="#vertexfields" aria-label="Permalink to &quot;\`vertexFields\`&quot;">​</a></h5><p>顶点属性，用于声明使用此材质渲染的网格的每个顶点持有哪些属性。在美术制作资源时确定。可能使用以下值：</p><ul><li><p><code class="shiki"><span>Position</span></code>：模型空间坐标</p></li><li><p><code class="shiki"><span>Color</span></code>：颜色</p></li><li><p><code class="shiki"><span>Normal</span></code>：法线</p></li><li><p><code class="shiki"><span>UV0</span></code>: 纹理采样坐标</p></li><li><p><code class="shiki"><span>UV1</span></code>：纹理采样坐标</p></li><li><p><code class="shiki"><span>UV2</span></code>：纹理采样坐标</p></li><li><p><code class="shiki"><span>BoneId0</span></code>：骨骼ID，用于骨骼模型</p></li></ul><h4 id="光栅化器环境配置" tabindex="-1">光栅化器环境配置 <a class="header-anchor" href="#光栅化器环境配置" aria-label="Permalink to &quot;光栅化器环境配置&quot;">​</a></h4><h5 id="msaasupport" tabindex="-1"><code class="shiki"><span>msaaSupport</span></code> <a class="header-anchor" href="#msaasupport" aria-label="Permalink to &quot;\`msaaSupport\`&quot;">​</a></h5><p>配置MSAA（多重采样抗锯齿）支持（引擎中默认为NonMSAA）</p><ul><li><p><code class="shiki"><span>NonMSAA</span></code>: 当MSAA未启用时允许材质</p></li><li><p><code class="shiki"><span>MSAA</span></code>: 当MSAA启用时允许材质</p></li><li><p><code class="shiki"><span>Both</span></code>：无论是否启用MSAA都允许材质。通常只使用此值。</p></li></ul><h5 id="depth-offset" tabindex="-1"><code class="shiki"><span>depth offset</span></code> <a class="header-anchor" href="#depth-offset" aria-label="Permalink to &quot;\`depth offset\`&quot;">​</a></h5><p>深度偏移主要用于解决z-fighting问题，即当两个物体的深度相似时，某些帧可能显示这个物体，而另一些帧显示另一个物体。深度偏移的原理是在较大或较小深度方向上偏移其中一个物体，使它们的深度不再相同。可以配置以下四个变量：</p><ul><li><p>depthBias</p></li><li><p>slopeScaledDepthBias</p></li><li><p>depthBiasOGL</p></li><li><p>slopeScaledDepthBiasOGL</p></li></ul><p>具体偏移深度为：</p><p><code class="shiki"><span>offset = (slopeScaledDepthBias * m) + (depthBias * r)</span></code></p><p>在OGL平台上为：</p><p><code class="shiki"><span>offset = (slopeScaledDepthBiasOGL * m) + (depthBiasOGL * r)</span></code></p><p>m是多边形深度斜率的最大值（在光栅化阶段计算）。多边形与近裁剪平面越平行，m越接近0。r是在窗口坐标系中产生可辨识深度值差异的最小值，r是由实现OpenGL的平台指定的常量。</p><p>关联状态渲染环境配置：</p><ul><li><p><code class="shiki"><span>Wireframe</span></code>：绘制线框模式</p></li><li><p><code class="shiki"><span>DisableCulling</span></code>: 同时渲染正面和背面</p></li><li><p><code class="shiki"><span>InvertCulling</span></code>：使用正面剔除。默认是背面剔除。声明此选项后，渲染背面并剔除正面。</p></li></ul><h4 id="图元" tabindex="-1">图元 <a class="header-anchor" href="#图元" aria-label="Permalink to &quot;图元&quot;">​</a></h4><h5 id="primitivemode" tabindex="-1"><code class="shiki"><span>primitiveMode</span></code> <a class="header-anchor" href="#primitivemode" aria-label="Permalink to &quot;\`primitiveMode\`&quot;">​</a></h5><p>图元渲染模式（引擎中默认为TriangleList）：</p><ul><li><p><code class="shiki"><span>None</span></code>：不渲染，通常不使用</p></li><li><p><code class="shiki"><span>QuadList</span></code>：四边形模式</p></li><li><p><code class="shiki"><span>TriangleList</span></code>: 每三个顶点绘制一个三角形的模式，例如第一个三角形使用顶点v0、v1、v2，第二个使用v3、v4、v5</p></li><li><p><code class="shiki"><span>TriangleStrip</span></code>: 每个顶点将与前两个顶点形成一个三角形，结构稍微复杂一些，但会节省数据量</p></li><li><p><code class="shiki"><span>LineList</span></code>: 每两个顶点绘制一条线段</p></li><li><p><code class="shiki"><span>Line</span></code>: 每个顶点与之前出现的顶点形成一条线段。</p></li></ul><h3 id="材质变体" tabindex="-1">材质变体 <a class="header-anchor" href="#材质变体" aria-label="Permalink to &quot;材质变体&quot;">​</a></h3><h4 id="variants" tabindex="-1"><code class="shiki"><span>variants</span></code> <a class="header-anchor" href="#variants" aria-label="Permalink to &quot;\`variants\`&quot;">​</a></h4><p>用于基于大部分相同定义快速实现多个子材质。参见下面entity_static的实际示例：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">    &quot;entity_static&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;vertexShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/entity.vertex&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;vrGeometryShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/entity.geometry&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;fragmentShader&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;shaders/entity.fragment&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;vertexFields&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Position&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Normal&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;UV0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">      ],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;variants&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">          &quot;skinning&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">            &quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;USE_SKINNING&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> ],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">            &quot;vertexFields&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Position&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;BoneId0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Normal&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;UV0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">            ]</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">          }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">          &quot;skinning_color&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">            &quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;USE_SKINNING&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;USE_OVERLAY&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> ],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">            &quot;+states&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Blending&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> ],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">            &quot;vertexFields&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Position&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;BoneId0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Color&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Normal&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> },</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">              { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;field&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;UV0&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">            ]</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">          }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">      ],</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;msaaSupport&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Both&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">      &quot;+samplerStates&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">          &quot;samplerIndex&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658;">0</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">          &quot;textureFilter&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;Point&quot;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">        }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">      ]</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Variants是材质变体的声明。上述声明定义了两个子变体，skinning和skinning_color。在子变体中重写了外部字段。在实际使用中，相当于快速定义了两种材质。主体和变体之间用点&quot;.&quot;连接。两种材质是entity_static.skinning和entity_static.skinning_color。</p><p>此外，如果有其他材质继承自entity_static，如entity_dynamic，此材质也会继承这两个变体，entity_dynamic.skinning和entity_dynamic.skinning_color。</p><h2 id="材质合并规则" tabindex="-1">材质合并规则 <a class="header-anchor" href="#材质合并规则" aria-label="Permalink to &quot;材质合并规则&quot;">​</a></h2><p>当在不同目录文件中声明相同的材质时，加载后将按照以下规则进行合并：1. 通常情况下，后加载的文件的材质字段将覆盖先前加载的。2. 以下字段是特殊的。支持使用&quot;+&quot;添加属性和使用&quot;-&quot;删除属性的操作：</p><ul><li>defines</li><li>states</li><li>samplerStates</li></ul><p>举例说明，例如在包体文件中声明了这样一个材质（无关代码省略），定义了三个宏：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;testMat&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_1&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_2&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_3&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> ],</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此时，一个MOD也声明了这个材质，定义了另外三个宏：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;testMat&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_4&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_5&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_6&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> ],</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在上述情况下，最终运行时相当于defines字段被覆盖，实际运行时生效的宏仅为：MACRO_4, MACRO_5, MACRO_6</p><p>如果在MOD中定义时使用&quot;+&quot;符号：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;testMat&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;+defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_4&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_5&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">, </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_6&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;"> ],</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>相当于在原有基础上添加定义，实际运行时生效的宏为：MACRO_1, MACRO_2, MACRO_3, MACRO_4, MACRO_5, MACRO_6</p><p>如果在MOD中定义时使用&quot;-&quot;符号：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;testMat&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;-defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_3&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">],</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>相当于在原有基础上删除一些定义，运行时生效的宏仅为：MACRO_1, MACRO_2</p><p>如果多个文件定义了相同的材质，并且涉及覆盖、添加和删除操作，它们生效的顺序为：首先执行所有覆盖操作，然后执行所有添加操作，最后执行所有删除操作。</p><p>即如果其中一个材质文件声明了删除MACRO_3操作：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes dark-plus light-plus vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">&quot;testMat&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5;">	&quot;-defines&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">: [ </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515;">&quot;MACRO_3&quot;</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">],</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>那么无论其他文件如何覆盖、添加MACRO_3，此材质在最终合成后都不得有MACRO_3宏。</p>`,128))])}const q=p(r,[["render",d]]);export{b as __pageData,q as default};
