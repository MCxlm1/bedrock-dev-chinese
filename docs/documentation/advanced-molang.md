---
title: 高级Molang
description: 了解Molang中更高级的主题。
mentions:
    - Ciosciaa
    - TheItsNameless
    - QuazChick
---

## 值

-   Molang中的所有表达式都会返回一个值以供相等性检查。大多数表达式返回`0`。值得注意的是，赋值返回分配的值，循环返回循环语句的解析值（如果存在）。
-   Molang中的所有值实际上都是单精度浮点数。
-   `this`用于引用字段在评估过程中累积的当前值。它只在动画中被观察到可用，但可能在其他地方也可用。例如，如果骨骼的`x` `scale`上的累积变换会产生`62`，则最终动画中`x` `scale`为`-this`将解析为`-62`，取消之前的变换。这在原版动画中的许多地方都有使用。在动画上下文之外，`this`似乎总是解析为`0`。

### 布尔值

-   布尔值可在Molang中使用。`true`解析为`1`，`false`解析为`0`。

### 数字

-   您可以在数字前面使用前导`0`，例如，为了让它们在代码中更好地对齐。
-   数字可以使用指数记数法，例如`2.5e2`，等于250。`e`后面可以跟`+`或`-`来指示幂次。
-   数字可以用单个`f`后缀，通常用于表示浮点值。这可以在原版代码中找到，但据信没有任何功能。

### 字符串

-   字符串使用`\`（在转义JSON中为`\\`）作为某种转义或其他功能。尚不清楚这有什么功能。已知后续2个字符会被传递给自己的子解析器，该解析器在遇到闭合`'`时无法正确退出；这意味着Molang字符串`"v.type = '\\x';"`是无效的。单独的`'`通常不允许，因为它表示字符串的结束，但在`\`之后的2个字符中允许使用`'`。
-   字符串值（大部分）是递增的，因为它们与浮点数对应。可以使用相等或比较运算符比较2个单字符字符串，甚至可以有效地"调整"单字符字符串的内容。多字符的此类行为尚不清楚。

## 运算符

完整的优先级列表，从最先到最后评估：

1. `()` 和 `[]`
2. `->`
3. `!` 和 `-` （一元负号）
4. `*` 和 `/`
5. `+` 和 `-` （二进制减法）
6. `<`, `<=`, `>`, 和 `>=`
7. `==` 和 `!=`
8. `&&`
9. `||`
10. `?` 和 `? :`
11. `??`
12. `=`
13. `return`

-   除条件运算符外，所有运算符都从左到右考虑。
-   不能在同一语句中使用多个`->`。
-   逻辑运算符短路。

## 语句

-   赋值返回分配的值。因此，如果需要从单个值中获得单独变量，可以链接赋值，如`v.iterator_x = (v.iterator_z = math.random_integer(16, 32));`。
-   大括号范围内最后一个语句不需要以`;`结尾。
-   可以在任何可以使用表达式的地方使用大括号。例如，`v.spawn_point ?? { v.target = false; };`将在`v.spawn_point`未定义时将`v.target`设置为`false`。

## 集合

-   数组下标的结果不能直接作为`+`、`-`、`*`或`/`的参数，但仍可以直接用作函数参数（甚至是数学函数）或与其他运算符一起使用。

## 评估

-   `initialize`和`pre_animation`是懒连接的。这些数组中的Molang字符串必须各自语法有效，但所有独立字符串的基本连接也必须是有效的Molang输入。

## 限制

-   Molang对语言功能没有表现出合理的限制，除了数字大小。在非常不合理的情况下，循环计数、字符串长度、Molang输入长度、集合大小等都被观察到仍然有效。